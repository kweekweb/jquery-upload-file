!function(e){void 0==e.fn.ajaxForm&&e.getScript(("https:"==document.location.protocol?"https://":"http://")+"malsup.github.io/jquery.form.js");var a={};a.fileapi=void 0!==e("<input type='file'/>").get(0).files,a.formdata=void 0!==window.FormData,e.fn.uploadFile=function(r){function t(){F||(F=!0,function e(){if(g.sequential||(g.sequentialCount=99999),0==S.length&&0==D.length)g.afterUploadAll&&g.afterUploadAll(b),F=!1;else{if(D.length<g.sequentialCount){var a=S.shift();void 0!=a&&(D.push(a),a.submit())}window.setTimeout(e,100)}}())}function o(a,r,t){t.on("dragenter",function(a){a.stopPropagation(),a.preventDefault(),e(this).addClass(r.dragDropHoverClass)}),t.on("dragover",function(a){a.stopPropagation(),a.preventDefault();var t=e(this);t.hasClass(r.dragDropContainerClass)&&!t.hasClass(r.dragDropHoverClass)&&t.addClass(r.dragDropHoverClass)}),t.on("drop",function(t){t.preventDefault(),e(this).removeClass(r.dragDropHoverClass),a.errorLog.html("");var o=t.originalEvent.dataTransfer.files;return!r.multiple&&o.length>1?void(r.showError&&e("<div class='"+r.errorClass+"'>"+r.multiDragErrorStr+"</div>").appendTo(a.errorLog)):void(0!=r.onSelect(o)&&l(r,a,o))}),t.on("dragleave",function(a){e(this).removeClass(r.dragDropHoverClass)}),e(document).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),e(document).on("dragover",function(a){a.stopPropagation(),a.preventDefault();var t=e(this);t.hasClass(r.dragDropContainerClass)||t.removeClass(r.dragDropHoverClass)}),e(document).on("drop",function(a){a.stopPropagation(),a.preventDefault(),e(this).removeClass(r.dragDropHoverClass)})}function s(e){var a="",r=e/1024;if(parseInt(r)>1024){var t=r/1024;a=t.toFixed(2)+" MB"}else a=r.toFixed(2)+" KB";return a}function i(a){var r=[];r="string"==jQuery.type(a)?a.split("&"):e.param(a).split("&");var t,o,s=r.length,i=[];for(t=0;s>t;t++)r[t]=r[t].replace(/\+/g," "),o=r[t].split("="),i.push([decodeURIComponent(o[0]),decodeURIComponent(o[1])]);return i}function l(a,r,t){for(var o=0;o<t.length;o++){if(n(r,a,t[o].name))return void(a.showError&&e("<div class='"+a.errorClass+"'><b>"+t[o].name+"</b> "+a.extErrorStr2+"</div>").appendTo(r.errorLog));if(d(r,a,t[o].name))if(a.allowDuplicates||!p(r,t[o].name))if(-1!=a.maxFileSize&&t[o].size>a.maxFileSize)a.showError&&e("<div class='"+a.errorClass+"'><b>"+t[o].name+"</b> "+a.sizeErrorStr+s(a.maxFileSize)+"</div>").appendTo(r.errorLog);else if(-1!=a.maxFileCount&&r.selectedFiles>=a.maxFileCount)a.showError&&e("<div class='"+a.errorClass+"'><b>"+t[o].name+"</b> "+a.maxFileCountErrorStr+a.maxFileCount+"</div>").appendTo(r.errorLog);else{r.selectedFiles++,r.existingFileNames.push(t[o].name);var l=a,u=new FormData,c=a.fileName.replace("[]","");u.append(c,t[o]);var h=a.formData;if(h)for(var f=i(h),m=0;m<f.length;m++)f[m]&&u.append(f[m][0],f[m][1]);l.fileData=u;var g=new v(r,a),C="";C=a.showFileCounter?r.fileCounter+a.fileCounterStyle+t[o].name:t[o].name,a.showFileSize&&(C+=" ("+s(t[o].size)+")"),g.filename.html(C);var b=e("<form style='display:block; position:absolute;left: 150px;' class='"+r.formGroup+"' method='"+a.method+"' action='"+a.url+"' enctype='"+a.enctype+"'></form>");b.appendTo("body");var x=[];x.push(t[o].name),w(b,l,g,x,r,t[o]),r.fileCounter++}else a.showError&&e("<div class='"+a.errorClass+"'><b>"+t[o].name+"</b> "+a.duplicateErrorStr+"</div>").appendTo(r.errorLog);else a.showError&&e("<div class='"+a.errorClass+"'><b>"+t[o].name+"</b> "+a.extErrorStr+a.allowedTypes+"</div>").appendTo(r.errorLog)}}function n(e,a,r){var t=a.blacklistedTypes.toLowerCase().split(/[\s,]+/g),o=r.split(".").pop().toLowerCase();return"*"==a.blacklistedTypes||jQuery.inArray(o,t)>=0?!0:!1}function d(e,a,r){var t=a.allowedTypes.toLowerCase().split(/[\s,]+/g),o=r.split(".").pop().toLowerCase();return"*"!=a.allowedTypes&&jQuery.inArray(o,t)<0?!1:!0}function p(e,a){var r=!1;if(e.existingFileNames.length)for(var t=0;t<e.existingFileNames.length;t++)(e.existingFileNames[t]==a||g.duplicateStrict&&e.existingFileNames[t].toLowerCase()==a.toLowerCase())&&(r=!0);return r}function u(e,a){if(e.existingFileNames.length)for(var r=0;r<a.length;r++){var t=e.existingFileNames.indexOf(a[r]);-1!=t&&e.existingFileNames.splice(t,1)}}function c(e,a){if(e){a.show();var r=new FileReader;r.onload=function(e){a.attr("src",e.target.result)},r.readAsDataURL(e)}}function h(a,r){if(a.showFileCounter){var t=e(r.container).find(".ajax-file-upload-filename").length;r.fileCounter=t+1,e(r.container).find(".ajax-file-upload-filename").each(function(r,o){var s=e(this).html().split(a.fileCounterStyle),i=(parseInt(s[0])-1,t+a.fileCounterStyle+s[1]);e(this).html(i),t--})}}function f(r,t,o,s){var i="ajax-upload-id-"+(new Date).getTime(),p=e("<form method='"+o.method+"' action='"+o.url+"' enctype='"+o.enctype+"'></form>"),u="<input type='file' id='"+i+"' name='"+o.fileName+"' accept='"+o.acceptFiles+"'/>";o.multiple&&(o.fileName.indexOf("[]")!=o.fileName.length-2&&(o.fileName+="[]"),u="<input type='file' id='"+i+"' name='"+o.fileName+"' accept='"+o.acceptFiles+"' multiple/>");var c=e(u).appendTo(p);c.change(function(){r.errorLog.html("");var i=(o.allowedTypes.toLowerCase().split(","),[]);if(this.files){for(C=0;C<this.files.length;C++)i.push(this.files[C].name);if(0==o.onSelect(this.files))return}else{var u=e(this).val(),c=[];if(i.push(u),n(r,o,u))return void(o.showError&&e("<div class='"+o.errorClass+"'><b>"+u+"</b> "+o.extErrorStr2+"</div>").appendTo(r.errorLog));if(!d(r,o,u))return void(o.showError&&e("<div class='"+o.errorClass+"'><b>"+u+"</b> "+o.extErrorStr+o.allowedTypes+"</div>").appendTo(r.errorLog));if(c.push({name:u,size:"NA"}),0==o.onSelect(c))return}if(h(o,r),s.unbind("click"),p.hide(),f(r,t,o,s),p.addClass(t),o.serialize&&a.fileapi&&a.formdata){p.removeClass(t);var m=this.files;p.remove(),l(o,r,m)}else{for(var g="",C=0;C<i.length;C++)g+=o.showFileCounter?r.fileCounter+o.fileCounterStyle+i[C]+"<br>":i[C]+"<br>",r.fileCounter++;if(-1!=o.maxFileCount&&r.selectedFiles+i.length>o.maxFileCount)return void(o.showError&&e("<div class='"+o.errorClass+"'><b>"+g+"</b> "+o.maxFileCountErrorStr+o.maxFileCount+"</div>").appendTo(r.errorLog));r.selectedFiles+=i.length;var b=new v(r,o);b.filename.html(g),w(p,o,b,i,r,null)}}),o.nestedForms?(p.css({margin:0,padding:0}),s.css({position:"relative",overflow:"hidden",cursor:"default"}),c.css({position:"absolute",cursor:"pointer",top:"0px",width:"100%",height:"100%",left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"}),p.appendTo(s)):(p.appendTo(e("body")),p.css({margin:0,padding:0,display:"block",position:"absolute",left:"-250px"}),-1!=navigator.appVersion.indexOf("MSIE ")?s.attr("for",i):s.click(function(){c.click()}))}function m(a,r){return this.statusbar=e("<div class='ajax-file-upload-statusbar'></div>").width(r.statusBarWidth),this.preview=e("<img class='ajax-file-upload-preview' />").width(r.previewWidth).height(r.previewHeight).appendTo(this.statusbar).hide(),this.filename=e("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar),this.progressDiv=e("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=e("<div class='ajax-file-upload-bar'></div>").appendTo(this.progressDiv),this.abort=e("<div>"+r.abortStr+"</div>").appendTo(this.statusbar).hide(),this.cancel=e("<div>"+r.cancelStr+"</div>").appendTo(this.statusbar).hide(),this.done=e("<div>"+r.doneStr+"</div>").appendTo(this.statusbar).hide(),this.download=e("<div>"+r.downloadStr+"</div>").appendTo(this.statusbar).hide(),this.del=e("<div>"+r.deletelStr+"</div>").appendTo(this.statusbar).hide(),this.abort.addClass("ajax-file-upload-red"),this.done.addClass("ajax-file-upload-green"),this.download.addClass("ajax-file-upload-green"),this.cancel.addClass("ajax-file-upload-red"),this.del.addClass("ajax-file-upload-red"),this}function v(a,r){var t=null;return t=r.customProgressBar?new r.customProgressBar(a,r):new m(a,r),t.abort.addClass(a.formGroup),t.abort.addClass(r.abortButtonClass),t.cancel.addClass(a.formGroup),t.cancel.addClass(r.cancelButtonClass),r.extraHTML&&(t.extraHTML=e("<div class='extrahtml'>"+r.extraHTML()+"</div>").insertAfter(t.filename)),"bottom"==r.uploadQueuOrder?e(a.container).append(t.statusbar):e(a.container).prepend(t.statusbar),t}function w(r,o,s,l,n,d){var p={cache:!1,contentType:!1,processData:!1,forceSync:!1,type:o.method,data:o.formData,formData:o.fileData,dataType:o.returnType,beforeSubmit:function(a,t,d){if(0!=o.onSubmit.call(this,l)){if(o.dynamicFormData){var p=i(o.dynamicFormData());if(p)for(var c=0;c<p.length;c++)p[c]&&(void 0!=o.fileData?d.formData.append(p[c][0],p[c][1]):d.data[p[c][0]]=p[c][1])}return o.extraHTML&&e(s.extraHTML).find("input,select,textarea").each(function(a,r){void 0!=o.fileData?d.formData.append(e(this).attr("name"),e(this).val()):d.data[e(this).attr("name")]=e(this).val()}),!0}return s.statusbar.append("<div class='"+o.errorClass+"'>"+o.uploadErrorStr+"</div>"),s.cancel.show(),r.remove(),s.cancel.click(function(){S.splice(S.indexOf(r),1),u(n,l),s.statusbar.remove(),o.onCancel.call(n,l,s),n.selectedFiles-=l.length,h(o,n)}),!1},beforeSend:function(e,r){s.progressDiv.show(),s.cancel.hide(),s.done.hide(),o.showAbort&&(s.abort.show(),s.abort.click(function(){u(n,l),e.abort(),n.selectedFiles-=l.length,o.onAbort.call(n,l,s)})),a.formdata?s.progressbar.width("1%"):s.progressbar.width("5%")},uploadProgress:function(e,a,r,t){t>98&&(t=98);var i=t+"%";t>1&&s.progressbar.width(i),o.showProgress&&(s.progressbar.html(i),s.progressbar.css("text-align","center"))},success:function(a,t,i){if(s.cancel.remove(),D.pop(),"json"==o.returnType&&"object"==e.type(a)&&a.hasOwnProperty(o.customErrorKeyStr)){s.abort.hide();var d=a[o.customErrorKeyStr];return o.onError.call(this,l,200,d,s),o.showStatusAfterError?(s.progressDiv.hide(),s.statusbar.append("<span class='"+o.errorClass+"'>ERROR: "+d+"</span>")):(s.statusbar.hide(),s.statusbar.remove()),n.selectedFiles-=l.length,void r.remove()}n.responses.push(a),s.progressbar.width("100%"),o.showProgress&&(s.progressbar.html("100%"),s.progressbar.css("text-align","center")),s.abort.hide(),o.onSuccess.call(this,l,a,i,s),o.showStatusAfterSuccess?(o.showDone?(s.done.show(),s.done.click(function(){s.statusbar.hide("slow"),s.statusbar.remove()})):s.done.hide(),o.showDelete?(s.del.show(),s.del.click(function(){u(n,l),s.statusbar.hide().remove(),o.deleteCallback&&o.deleteCallback.call(this,a,s),n.selectedFiles-=l.length,h(o,n)})):s.del.hide()):(s.statusbar.hide("slow"),s.statusbar.remove()),o.showDownload&&(s.download.show(),s.download.click(function(){o.downloadCallback&&o.downloadCallback(a)})),r.remove()},error:function(e,a,t){s.cancel.remove(),D.pop(),s.abort.hide(),"abort"==e.statusText?(s.statusbar.hide("slow").remove(),h(o,n)):(o.onError.call(this,l,a,t,s),o.showStatusAfterError?(s.progressDiv.hide(),s.statusbar.append("<span class='"+o.errorClass+"'>ERROR: "+t+"</span>")):(s.statusbar.hide(),s.statusbar.remove()),n.selectedFiles-=l.length),r.remove()}};o.showPreview&&null!=d&&"image"==d.type.toLowerCase().split("/").shift()&&c(d,s.preview),o.autoSubmit?(r.ajaxForm(p),S.push(r),t()):(o.showCancel&&(s.cancel.show(),s.cancel.click(function(){S.splice(S.indexOf(r),1),u(n,l),r.remove(),s.statusbar.remove(),o.onCancel.call(n,l,s),n.selectedFiles-=l.length,h(o,n)})),r.ajaxForm(p))}var g=e.extend({url:"",method:"POST",enctype:"multipart/form-data",returnType:null,allowDuplicates:!0,duplicateStrict:!1,blacklistedTypes:"",allowedTypes:"*",acceptFiles:"*",fileName:"file",formData:!1,dynamicFormData:!1,maxFileSize:-1,maxFileCount:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!1,showDelete:!1,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:"). ",showFileSize:!0,showProgress:!1,nestedForms:!0,showDownload:!1,onLoad:function(e){},onSelect:function(e){return!0},onSubmit:function(e,a){},onSuccess:function(e,a,r,t){},onError:function(e,a,r,t){},onCancel:function(e,a){},onAbort:function(e,a){},downloadCallback:!1,deleteCallback:!1,afterUploadAll:!1,serialize:!0,sequential:!1,sequentialCount:2,customProgressBar:!1,abortButtonClass:"ajax-file-upload-abort",cancelButtonClass:"ajax-file-upload-cancel",dragDropContainerClass:"ajax-upload-dragdrop",dragDropHoverClass:"state-hover",errorClass:"ajax-file-upload-error",uploadButtonClass:"ajax-file-upload",dragDropStr:"<span><b>Drag &amp; Drop Files</b></span>",uploadStr:"Upload",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",extErrorStr2:"is not allowed.",duplicateErrorStr:"is not allowed. File already exists.",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed",maxFileCountErrorStr:" is not allowed. Maximum allowed files are:",downloadStr:"Download",customErrorKeyStr:"jquery-upload-file-error",showQueueDiv:!1,statusBarWidth:400,dragdropWidth:400,showPreview:!1,previewHeight:"auto",previewWidth:"100%",extraHTML:!1,uploadQueuOrder:"top"},r);this.fileCounter=1,this.selectedFiles=0;var C="ajax-file-upload-"+(new Date).getTime();this.formGroup=C,this.errorLog=e("<div></div>"),this.responses=[],this.existingFileNames=[],a.formdata||(g.dragDrop=!1),a.formdata||(g.multiple=!1),e(this).html("");var b=this,x=e("<div>"+g.uploadStr+"</div>");e(x).addClass(g.uploadButtonClass),function y(){if(e.fn.ajaxForm){if(g.dragDrop){var a=e('<div class="'+g.dragDropContainerClass+'" style="vertical-align:top;"></div>').width(g.dragdropWidth);e(b).append(a),e(a).append(x),e(a).append(e(g.dragDropStr)),o(b,g,a)}else e(b).append(x);e(b).append(b.errorLog),g.showQueueDiv?b.container=e("#"+g.showQueueDiv):b.container=e("<div class='ajax-file-upload-container'></div>").insertAfter(e(b)),g.onLoad.call(this,b),f(b,C,g,x)}else window.setTimeout(y,10)}(),this.startUpload=function(){e("form").each(function(a,r){e(this).hasClass(b.formGroup)&&S.push(e(this))}),S.length>=1&&t()},this.getFileCount=function(){return b.selectedFiles},this.stopUpload=function(){e("."+g.abortButtonClass).each(function(a,r){e(this).hasClass(b.formGroup)&&e(this).click()}),e("."+g.cancelButtonClass).each(function(a,r){e(this).hasClass(b.formGroup)&&e(this).click()})},this.cancelAll=function(){e("."+g.cancelButtonClass).each(function(a,r){e(this).hasClass(b.formGroup)&&e(this).click()})},this.update=function(a){g=e.extend(g,a)},this.reset=function(e){b.fileCounter=1,b.selectedFiles=0,b.errorLog.html(""),0!=e&&b.container.html("")},this.remove=function(){b.container.html(""),e(b).remove()},this.createProgress=function(e,a,r){var t=new v(this,g);t.progressDiv.show(),t.progressbar.width("100%");var o="";o=g.showFileCounter?b.fileCounter+g.fileCounterStyle+e:e,g.showFileSize&&(o+=" ("+s(r)+")"),t.filename.html(o),b.fileCounter++,b.selectedFiles++,g.showPreview&&(t.preview.attr("src",a),t.preview.show()),g.showDownload&&(t.download.show(),t.download.click(function(){g.downloadCallback&&g.downloadCallback.call(b,[e])})),g.showDelete&&(t.del.show(),t.del.click(function(){t.statusbar.hide().remove();var a=[e];g.deleteCallback&&g.deleteCallback.call(this,a,t),b.selectedFiles-=1,h(g,b)}))},this.getResponses=function(){return this.responses};var S=[],D=[],F=!1;return this}}(jQuery);
